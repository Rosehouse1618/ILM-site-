<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Administrative dashboard for managing iLm Halal Student Halls applications and bookings. Staff access only.">
  <meta name="robots" content="noindex, nofollow">
  
  <title>Admin Dashboard - iLm Halal Student Halls</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dq8l3fhb2/image/upload/v1748189942/web-app-manifest-192x192_wr5wdr.png">
  
  <!-- CSS Files -->
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="../css/admin.css">
  
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- PDF Generation Library with fallbacks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js" 
          integrity="sha512-nVrqJe4vvBkEHo/4qTI2fOqgFIvFyLJMvIhJ6Dq0PgNz+3Ep5g8k0UgE1kUJ3N5uHx8Jl/3DGKuP5B7LN6vHw==" 
          crossorigin="anonymous" 
          referrerpolicy="no-referrer"
          onerror="loadJsPDFFallback()"></script>
  
  <script>
    // Fallback loading for jsPDF
    function loadJsPDFFallback() {
      console.log('Primary jsPDF CDN failed, trying fallback...');
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/jspdf@2.5.2/dist/jspdf.umd.min.js';
      script.onerror = function() {
        console.log('Fallback CDN failed, trying jsdelivr...');
        const script2 = document.createElement('script');
        script2.src = 'https://cdn.jsdelivr.net/npm/jspdf@2.5.2/dist/jspdf.umd.min.js';
        script2.onerror = function() {
          console.error('All jsPDF CDNs failed to load');
          window.jsPDFLoadError = true;
        };
        document.head.appendChild(script2);
      };
      document.head.appendChild(script);
    }
    
    // Check if jsPDF loaded successfully
    window.addEventListener('load', function() {
      setTimeout(() => {
        if (!window.jspdf && !window.jsPDFLoadError) {
          console.log('jsPDF not detected, attempting manual load...');
          loadJsPDFFallback();
        } else if (window.jspdf) {
          console.log('‚úÖ jsPDF loaded successfully');
        }
      }, 1000);
    });
  </script>
</head>
<body>
  <!-- Notification Element -->
  <div id="notification" class="notification"></div>

  <!-- Admin Container with Sidebar Layout -->
  <div class="admin-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <h2>üè¢ iLm Admin</h2>
      
      <!-- Navigation Menu -->
      <nav>
        <button onclick="loadSection('overview')" class="active">
          üè† Overview
        </button>
        <button onclick="loadSection('users')">
          üë• Users
        </button>
        <button onclick="loadSection('bookings')">
          üìã Bookings
        </button>
        <button onclick="loadSection('gallery')">
          üñºÔ∏è Gallery
        </button>
        <button onclick="loadSection('analytics')">
          üìä Analytics
        </button>
      </nav>
      
      <!-- Sidebar Footer -->
      <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
        <button onclick="logout()" style="background: rgba(231, 76, 60, 0.8); color: white; width: 100%; padding: 10px; border: none; border-radius: 5px; cursor: pointer;">
          üö™ Logout
        </button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <div id="main">
        <!-- Content will be loaded dynamically here -->
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Loading dashboard...</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Modals Container -->
  <div id="modals-container">
    <!-- View/Edit Application Modal -->
    <div id="applicationModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Application Details</h3>
          <button class="close-modal" onclick="closeModal()">&times;</button>
        </div>
        <div id="modalBody">
          <!-- Application details will be loaded here -->
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeModal()">Close</button>
          <button class="btn btn-info" onclick="downloadPDF()" id="pdfBtn">üìÑ Download PDF</button>
          <button class="btn btn-primary" onclick="saveApplication()" id="saveBtn">Save Changes</button>
          <button class="btn btn-success" onclick="approveApplication()" id="approveBtn">Approve</button>
          <button class="btn btn-danger" onclick="rejectApplication()" id="rejectBtn">Reject</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>System Settings</h3>
          <button class="close-modal" onclick="closeSettingsModal()">&times;</button>
        </div>
        <div id="settingsBody">
          <div class="settings-section">
            <h4>Notifications</h4>
            <div class="setting-item">
              <div>
                <div class="setting-label">Email Notifications</div>
                <div class="setting-description">Receive email notifications for new applications</div>
              </div>
              <div class="toggle-switch active" onclick="toggleSetting(this, 'emailNotifications')"></div>
            </div>
            <div class="setting-item">
              <div>
                <div class="setting-label">Browser Notifications</div>
                <div class="setting-description">Show browser notifications for real-time updates</div>
              </div>
              <div class="toggle-switch" onclick="toggleSetting(this, 'browserNotifications')"></div>
            </div>
          </div>
          
          <div class="settings-section">
            <h4>Dashboard</h4>
            <div class="setting-item">
              <div>
                <div class="setting-label">Auto Refresh</div>
                <div class="setting-description">Automatically refresh data every 30 seconds</div>
              </div>
              <div class="toggle-switch" onclick="toggleSetting(this, 'autoRefresh')"></div>
            </div>
            <div class="setting-item">
              <div>
                <div class="setting-label">Real-time Updates</div>
                <div class="setting-description">Enable live updates for new applications</div>
              </div>
              <div class="toggle-switch active" onclick="toggleSetting(this, 'realTimeUpdates')"></div>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeSettingsModal()">Close</button>
          <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
      </div>
    </div>

    <!-- Bulk Actions Modal -->
    <div id="bulkModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Bulk Actions</h3>
          <button class="close-modal" onclick="closeBulkModal()">&times;</button>
        </div>
        <div id="bulkBody">
          <p>Select applications from the list to perform bulk actions.</p>
          <div class="bulk-actions-buttons">
            <button class="btn btn-success" onclick="bulkApprove()">‚úÖ Approve Selected</button>
            <button class="btn btn-danger" onclick="bulkReject()">‚ùå Reject Selected</button>
            <button class="btn btn-secondary" onclick="bulkArchive()">üì¶ Archive Selected</button>
            <button class="btn btn-info" onclick="bulkExport()">üìä Export Selected</button>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="closeBulkModal()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="../js/admin.js" defer></script>
  
  <!-- Additional Modal Functions -->
  <script>
    // Modal helper functions
    function closeModal() {
      const modal = document.getElementById('applicationModal');
      if (modal) modal.style.display = 'none';
    }
    
    function closeSettingsModal() {
      const modal = document.getElementById('settingsModal');
      if (modal) modal.style.display = 'none';
    }
    
    function closeBulkModal() {
      const modal = document.getElementById('bulkModal');
      if (modal) modal.style.display = 'none';
    }
    
    function showSettings() {
      const modal = document.getElementById('settingsModal');
      if (modal) modal.style.display = 'block';
    }
    
    function showBulkActions() {
      const modal = document.getElementById('bulkModal');
      if (modal) modal.style.display = 'block';
    }
    
    function toggleSetting(element, setting) {
      element.classList.toggle('active');
      console.log(`Setting ${setting} toggled:`, element.classList.contains('active'));
    }
    
    function saveSettings() {
      showNotification('Settings saved successfully!', 'success');
      closeSettingsModal();
    }
    
    // Placeholder functions for missing functionality
    function downloadPDF() {
      showNotification('PDF download functionality will be implemented in the full version', 'info');
    }
    
    function saveApplication() {
      showNotification('Save functionality will be implemented in the full version', 'info');
    }
    
    function approveApplication() {
      showNotification('Approve functionality will be implemented in the full version', 'info');
    }
    
    function rejectApplication() {
      showNotification('Reject functionality will be implemented in the full version', 'info');
    }
    
    function bulkApprove() {
      showNotification('Bulk approve functionality will be implemented in the full version', 'info');
    }
    
    function bulkReject() {
      showNotification('Bulk reject functionality will be implemented in the full version', 'info');
    }
    
    function bulkArchive() {
      showNotification('Bulk archive functionality will be implemented in the full version', 'info');
    }
    
    function bulkExport() {
      showNotification('Bulk export functionality will be implemented in the full version', 'info');
    }
    
    function updateBulkActions() {
      // Placeholder for bulk actions update
      console.log('Bulk actions updated');
    }
    
    // Close modal when clicking outside
    window.onclick = function(event) {
      const applicationModal = document.getElementById('applicationModal');
      const settingsModal = document.getElementById('settingsModal');
      const bulkModal = document.getElementById('bulkModal');
      
      if (event.target === applicationModal) {
        closeModal();
      } else if (event.target === settingsModal) {
        closeSettingsModal();
      } else if (event.target === bulkModal) {
        closeBulkModal();
      }
    }
  </script>
</body>
</html>